#!/bin/bash

set -e

paths_file="/nfs/users/nfs_f/fc4/lustre_scratch118/67.mtb_within_host/datasets/mtb_wh_extended.v1.run_accessions.lane_ids.fastq_paths.missing_mapping_qc_stats.txt";
snippy_dir="/nfs/users/nfs_f/fc4/lustre_scratch118/67.mtb_within_host/mapping/snippy/";
snippy_vcf_dir="/nfs/users/nfs_f/fc4/lustre_scratch118/67.mtb_within_host/mapping/snippy_vcfs/";

laSamples=`awk -F'\t' '{ print $1}' $paths_file`;

cd /nfs/users/nfs_f/fc4/lustre_scratch118/67.mtb_within_host/mapping

for sample in $laSamples
do

	echo $sample

	out_dir=$snippy_dir$sample;
	out_vcf=$out_dir"/snps.vcf";
	out_vcf2=$snippy_vcf_dir$sample".vcf";

	if [ -f $out_vcf ]
	then
		if [ ! -f $out_vcf2 ]
		then
			cp $out_vcf $out_vcf2
			bgzip-1.9 -c $out_vcf2 > $out_vcf2".gz"
			tabix-1.9 -p vcf $out_vcf2".gz"
		fi
	fi

	out_vcf=$out_dir"/snps.raw.vcf";
	out_vcf2=$snippy_vcf_dir$sample".raw.vcf";

	if [ -f $out_vcf ]
	then
		if [ ! -f $out_vcf2 ]
		then
			cp $out_vcf $out_vcf2
			bgzip-1.9 -c $out_vcf2 > $out_vcf2".gz"
			tabix-1.9 -p vcf $out_vcf2".gz"
		fi
	fi
done